"use strict";var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};sjcl.cipher.aes=function(h){if(!this._tables[0][0][0]){this._precompute()}var d,c,e,g,l,f=this._tables[0][4],k=this._tables[1],a=h.length,b=1;if(a!==4&&a!==6&&a!==8){throw new sjcl.exception.invalid("invalid aes key size")}this._key=[g=h.slice(0),l=[]];for(d=a;d<4*a+28;d++){e=g[d-1];if(d%a===0||(a===8&&d%a===4)){e=f[e>>>24]<<24^f[e>>16&255]<<16^f[e>>8&255]<<8^f[e&255];if(d%a===0){e=e<<8^e>>>24^b<<24;b=b<<1^(b>>7)*283}}g[d]=g[d-a]^e}for(c=0;d;c++,d--){e=g[c&3?d:d-4];if(d<=4||c<4){l[c]=e}else{l[c]=k[0][f[e>>>24]]^k[1][f[e>>16&255]]^k[2][f[e>>8&255]]^k[3][f[e&255]]}}};sjcl.cipher.aes.prototype={encrypt:function(a){return this._crypt(a,0)},decrypt:function(a){return this._crypt(a,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var j=this._tables[0],q=this._tables[1],h=j[4],n=q[4],g,l,f,k=[],c=[],b,p,m,o,e,a;for(g=0;g<0x100;g++){c[(k[g]=g<<1^(g>>7)*283)^g]=g}for(l=f=0;!h[l];l^=b||1,f=c[f]||1){o=f^f<<1^f<<2^f<<3^f<<4;o=o>>8^o&255^99;h[l]=o;n[o]=l;m=k[p=k[b=k[l]]];a=m*0x1010101^p*0x10001^b*0x101^l*0x1010100;e=k[o]*0x101^o*0x1010100;for(g=0;g<4;g++){j[g][l]=e=e<<24^e>>>8;q[g][o]=a=a<<24^a>>>8}}for(g=0;g<5;g++){j[g]=j[g].slice(0);q[g]=q[g].slice(0)}},_crypt:function(k,n){if(k.length!==4){throw new sjcl.exception.invalid("invalid aes block size")}var y=this._key[n],v=k[0]^y[0],u=k[n?3:1]^y[1],t=k[2]^y[2],s=k[n?1:3]^y[3],w,e,m,x=y.length/4-2,p,o=4,q=[0,0,0,0],r=this._tables[n],j=r[0],h=r[1],g=r[2],f=r[3],l=r[4];for(p=0;p<x;p++){w=j[v>>>24]^h[u>>16&255]^g[t>>8&255]^f[s&255]^y[o];e=j[u>>>24]^h[t>>16&255]^g[s>>8&255]^f[v&255]^y[o+1];m=j[t>>>24]^h[s>>16&255]^g[v>>8&255]^f[u&255]^y[o+2];s=j[s>>>24]^h[v>>16&255]^g[u>>8&255]^f[t&255]^y[o+3];o+=4;v=w;u=e;t=m}for(p=0;p<4;p++){q[n?3&-p:p]=l[v>>>24]<<24^l[u>>16&255]<<16^l[t>>8&255]<<8^l[s&255]^y[o++];w=v;v=u;u=t;t=s;s=w}return q}};sjcl.bitArray={bitSlice:function(b,c,d){b=sjcl.bitArray._shiftRight(b.slice(c/32),32-(c&31)).slice(1);return(d===undefined)?b:sjcl.bitArray.clamp(b,d-c)},extract:function(c,d,f){var b,e=Math.floor((-d-f)&31);if((d+f-1^d)&-32){b=(c[d/32|0]<<(32-e))^(c[d/32+1|0]>>>e)}else{b=c[d/32|0]>>>e}return b&((1<<f)-1)},concat:function(c,a){if(c.length===0||a.length===0){return c.concat(a)}var d=c[c.length-1],b=sjcl.bitArray.getPartial(d);if(b===32){return c.concat(a)}else{return sjcl.bitArray._shiftRight(a,b,d|0,c.slice(0,c.length-1))}},bitLength:function(d){var c=d.length,b;if(c===0){return 0}b=d[c-1];return(c-1)*32+sjcl.bitArray.getPartial(b)},clamp:function(d,b){if(d.length*32<b){return d}d=d.slice(0,Math.ceil(b/32));var c=d.length;b=b&31;if(c>0&&b){d[c-1]=sjcl.bitArray.partial(b,d[c-1]&2147483648>>(b-1),1)}return d},partial:function(b,a,c){if(b===32){return a}return(c?a|0:a<<(32-b))+b*0x10000000000},getPartial:function(a){return Math.round(a/0x10000000000)||32},equal:function(e,d){if(sjcl.bitArray.bitLength(e)!==sjcl.bitArray.bitLength(d)){return false}var c=0,f;for(f=0;f<e.length;f++){c|=e[f]^d[f]}return(c===0)},_shiftRight:function(d,c,h,f){var g,b=0,e;if(f===undefined){f=[]}for(;c>=32;c-=32){f.push(h);h=0}if(c===0){return f.concat(d)}for(g=0;g<d.length;g++){f.push(h|d[g]>>>c);h=d[g]<<(32-c)}b=d.length?d[d.length-1]:0;e=sjcl.bitArray.getPartial(b);f.push(sjcl.bitArray.partial(c+e&31,(c+e>32)?h:f.pop(),1));return f},_xor4:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]},byteswapM:function(c){var e,d,b=0xff00;for(e=0;e<c.length;++e){d=c[e];c[e]=(d>>>24)|((d>>>8)&b)|((d&b)<<8)|(d<<24)}return c}};sjcl.codec.utf8String={fromBits:function(a){var b="",e=sjcl.bitArray.bitLength(a),d,c;for(d=0;d<e/8;d++){if((d&3)===0){c=a[d/4]}b+=String.fromCharCode(c>>>8>>>8>>>8);c<<=8}return decodeURIComponent(escape(b))},toBits:function(d){d=unescape(encodeURIComponent(d));var a=[],c,b=0;for(c=0;c<d.length;c++){b=b<<8|d.charCodeAt(c);if((c&3)===3){a.push(b);b=0}}if(c&3){a.push(sjcl.bitArray.partial(8*(c&3),b))}return a}};sjcl.codec.bytes={fromBits:function(a){var b=[],e=sjcl.bitArray.bitLength(a),d,c;for(d=0;d<e/8;d++){if((d&3)===0){c=a[d/4]}b.push(c>>>24);c<<=8}return b},toBits:function(a){var b=[],d,c=0;for(d=0;d<a.length;d++){c=c<<8|a[d];if((d&3)===3){b.push(c);c=0}}if(d&3){b.push(sjcl.bitArray.partial(8*(d&3),c))}return b}};sjcl.mode.gcm={name:"gcm",encrypt:function(h,g,c,e,d){var b,f=g.slice(0),a=sjcl.bitArray;d=d||128;e=e||[];b=sjcl.mode.gcm._ctrMode(true,h,f,e,c,d);return a.concat(b.data,b.tag)},decrypt:function(a,c,e,i,d){var f,g=c.slice(0),j,h=sjcl.bitArray,b=h.bitLength(g);d=d||128;i=i||[];if(d<=b){j=h.bitSlice(g,b-d);g=h.bitSlice(g,0,b-d)}else{j=g;g=[]}f=sjcl.mode.gcm._ctrMode(false,a,g,i,e,d);if(!h.equal(f.tag,j)){throw new sjcl.exception.corrupt("gcm: tag doesn't match")}return f.data},_galoisMultiply:function(k,g){var c,b,f,a,e,h,l=sjcl.bitArray,d=l._xor4;a=[0,0,0,0];e=g.slice(0);for(c=0;c<128;c++){f=(k[Math.floor(c/32)]&(1<<(31-c%32)))!==0;if(f){a=d(a,e)}h=(e[3]&1)!==0;for(b=3;b>0;b--){e[b]=(e[b]>>>1)|((e[b-1]&1)<<31)}e[0]=e[0]>>>1;if(h){e[0]=e[0]^(225<<24)}}return a},_ghash:function(c,f,e){var d,b,a=e.length;d=f.slice(0);for(b=0;b<a;b+=4){d[0]^=0xffffffff&e[b];d[1]^=0xffffffff&e[b+1];d[2]^=0xffffffff&e[b+2];d[3]^=0xffffffff&e[b+3];d=sjcl.mode.gcm._galoisMultiply(d,c)}return d},_ctrMode:function(m,k,t,q,e,a){var j,c,f,d,p,r,u,g,n,b,o,s,h=sjcl.bitArray;n=t.length;b=h.bitLength(t);o=h.bitLength(q);s=h.bitLength(e);j=k.encrypt([0,0,0,0]);if(s===96){c=e.slice(0);c=h.concat(c,[1])}else{c=sjcl.mode.gcm._ghash(j,[0,0,0,0],e);c=sjcl.mode.gcm._ghash(j,c,[0,0,Math.floor(s/0x100000000),s&0xffffffff])}f=sjcl.mode.gcm._ghash(j,[0,0,0,0],q);r=c.slice(0);u=f.slice(0);if(!m){u=sjcl.mode.gcm._ghash(j,f,t)}for(p=0;p<n;p+=4){r[3]++;d=k.encrypt(r);t[p]^=d[0];t[p+1]^=d[1];t[p+2]^=d[2];t[p+3]^=d[3]}t=h.clamp(t,b);if(m){u=sjcl.mode.gcm._ghash(j,f,t)}g=[Math.floor(o/0x100000000),o&0xffffffff,Math.floor(b/0x100000000),b&0xffffffff];u=sjcl.mode.gcm._ghash(j,u,g);d=k.encrypt(c);u[0]^=d[0];u[1]^=d[1];u[2]^=d[2];u[3]^=d[3];return{tag:h.bitSlice(u,0,a),data:t}}};if(typeof module!=="undefined"&&module.exports){module.exports=sjcl}if(typeof define==="function"){define([],function(){return sjcl})};